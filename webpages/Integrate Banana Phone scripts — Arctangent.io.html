<!DOCTYPE html>
<!-- saved from url=(0048)https://www.arctangent.io/integrate-banana-phone -->
<html xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml" xmlns:website="http://ogp.me/ns/website" lang="en-US" itemscope="" itemtype="http://schema.org/WebPage" class="yui3-js-enabled js flexbox canvas canvastext webgl no-touch hashchange history draganddrop rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms no-csstransforms3d csstransitions video audio svg inlinesvg svgclippaths wf-proximanova-n3-active wf-proximanova-n4-active wf-proximanova-n7-active wf-proximanova-n1-active wf-proximanova-i1-active wf-proximanova-i3-active wf-proximanova-n5-active wf-proximanova-i4-active wf-proximanova-i5-active wf-proximanova-n6-active wf-proximanova-i6-active wf-proximanova-i7-active wf-proximanova-i8-active wf-proximanova-n9-active wf-proximanova-n8-active wf-proximanova-i9-active wf-active" style="" id="yui_3_17_2_1_1546885903013_118"><div id="yui3-css-stamp" style="position: absolute !important; visibility: hidden !important"></div><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
  <meta name="viewport" content="initial-scale=1">
  
  <!-- This is Squarespace. --><!-- alex-ruiz-7fpx -->
<!--<base href="">--><base href=".">

<title>Integrate Banana Phone scripts — Arctangent.io</title>
<link rel="shortcut icon" type="image/x-icon" href="https://static1.squarespace.com/static/583dc6b829687f52b54693f1/t/58fff80662a431db04c7f3b3/favicon.ico">
<link rel="canonical" href="https://www.arctangent.io/integrate-banana-phone/">
<meta property="og:site_name" content="Arctangent.io">
<meta property="og:title" content="Integrate Banana Phone scripts — Arctangent.io">
<meta property="og:url" content="https://www.arctangent.io/integrate-banana-phone/">
<meta property="og:type" content="website">
<meta itemprop="name" content="Integrate Banana Phone scripts — Arctangent.io">
<meta itemprop="url" content="https://www.arctangent.io/integrate-banana-phone/">
<meta name="twitter:title" content="Integrate Banana Phone scripts — Arctangent.io">
<meta name="twitter:url" content="https://www.arctangent.io/integrate-banana-phone/">
<meta name="twitter:card" content="summary">
<meta name="description" content="">
<script type="text/javascript" src="./Integrate Banana Phone scripts — Arctangent.io_files/M24sYhZ45gHKuOXK8YuA64RcYJB5_sADHpHKoui_gfJfezCffFHN4UJLFRbh52jhWD9twhsRFcJtwRqh52icFQ4KFQbh5QFcws7wMPG0jAU8pfukiA8EOQicSY60SaBujW48Sagyjh90jhNlOeBCZW6lS1mTpKXaZ1gtO1FUiABkZWF3jAF8OcFzdPUyScFXjAo1ZAoXOc8zOeUzjhBC-eNDifUaiaS0jAU8pfukiA8EOQicSY60SaBujW48.js"></script>
<style type="text/css">@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/ed0e78/00000000000000003b9b0931/27/l?subset_id=2&fvd=n1&v=3) format("woff2"),url(https://use.typekit.net/af/ed0e78/00000000000000003b9b0931/27/d?subset_id=2&fvd=n1&v=3) format("woff"),url(https://use.typekit.net/af/ed0e78/00000000000000003b9b0931/27/a?subset_id=2&fvd=n1&v=3) format("opentype");font-weight:100;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/942fe1/00000000000000003b9b0930/27/l?subset_id=2&fvd=i1&v=3) format("woff2"),url(https://use.typekit.net/af/942fe1/00000000000000003b9b0930/27/d?subset_id=2&fvd=i1&v=3) format("woff"),url(https://use.typekit.net/af/942fe1/00000000000000003b9b0930/27/a?subset_id=2&fvd=i1&v=3) format("opentype");font-weight:100;font-style:italic;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/437c3d/00000000000000003b9b0932/27/l?subset_id=2&fvd=n3&v=3) format("woff2"),url(https://use.typekit.net/af/437c3d/00000000000000003b9b0932/27/d?subset_id=2&fvd=n3&v=3) format("woff"),url(https://use.typekit.net/af/437c3d/00000000000000003b9b0932/27/a?subset_id=2&fvd=n3&v=3) format("opentype");font-weight:300;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/f02b29/00000000000000003b9b0933/27/l?subset_id=2&fvd=i3&v=3) format("woff2"),url(https://use.typekit.net/af/f02b29/00000000000000003b9b0933/27/d?subset_id=2&fvd=i3&v=3) format("woff"),url(https://use.typekit.net/af/f02b29/00000000000000003b9b0933/27/a?subset_id=2&fvd=i3&v=3) format("opentype");font-weight:300;font-style:italic;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/4838bd/00000000000000003b9b0934/27/l?subset_id=2&fvd=n4&v=3) format("woff2"),url(https://use.typekit.net/af/4838bd/00000000000000003b9b0934/27/d?subset_id=2&fvd=n4&v=3) format("woff"),url(https://use.typekit.net/af/4838bd/00000000000000003b9b0934/27/a?subset_id=2&fvd=n4&v=3) format("opentype");font-weight:400;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/6aec08/00000000000000003b9b0935/27/l?subset_id=2&fvd=i4&v=3) format("woff2"),url(https://use.typekit.net/af/6aec08/00000000000000003b9b0935/27/d?subset_id=2&fvd=i4&v=3) format("woff"),url(https://use.typekit.net/af/6aec08/00000000000000003b9b0935/27/a?subset_id=2&fvd=i4&v=3) format("opentype");font-weight:400;font-style:italic;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/3331e6/00000000000000003b9b0936/27/l?subset_id=2&fvd=n5&v=3) format("woff2"),url(https://use.typekit.net/af/3331e6/00000000000000003b9b0936/27/d?subset_id=2&fvd=n5&v=3) format("woff"),url(https://use.typekit.net/af/3331e6/00000000000000003b9b0936/27/a?subset_id=2&fvd=n5&v=3) format("opentype");font-weight:500;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/1cd3b2/00000000000000003b9b0937/27/l?subset_id=2&fvd=i5&v=3) format("woff2"),url(https://use.typekit.net/af/1cd3b2/00000000000000003b9b0937/27/d?subset_id=2&fvd=i5&v=3) format("woff"),url(https://use.typekit.net/af/1cd3b2/00000000000000003b9b0937/27/a?subset_id=2&fvd=i5&v=3) format("opentype");font-weight:500;font-style:italic;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/27776b/00000000000000003b9b0939/27/l?subset_id=2&fvd=n6&v=3) format("woff2"),url(https://use.typekit.net/af/27776b/00000000000000003b9b0939/27/d?subset_id=2&fvd=n6&v=3) format("woff"),url(https://use.typekit.net/af/27776b/00000000000000003b9b0939/27/a?subset_id=2&fvd=n6&v=3) format("opentype");font-weight:600;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/256534/00000000000000003b9b0938/27/l?subset_id=2&fvd=i6&v=3) format("woff2"),url(https://use.typekit.net/af/256534/00000000000000003b9b0938/27/d?subset_id=2&fvd=i6&v=3) format("woff"),url(https://use.typekit.net/af/256534/00000000000000003b9b0938/27/a?subset_id=2&fvd=i6&v=3) format("opentype");font-weight:600;font-style:italic;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/71f83c/00000000000000003b9b093b/27/l?subset_id=2&fvd=n7&v=3) format("woff2"),url(https://use.typekit.net/af/71f83c/00000000000000003b9b093b/27/d?subset_id=2&fvd=n7&v=3) format("woff"),url(https://use.typekit.net/af/71f83c/00000000000000003b9b093b/27/a?subset_id=2&fvd=n7&v=3) format("opentype");font-weight:700;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/86b539/00000000000000003b9b093a/27/l?subset_id=2&fvd=i7&v=3) format("woff2"),url(https://use.typekit.net/af/86b539/00000000000000003b9b093a/27/d?subset_id=2&fvd=i7&v=3) format("woff"),url(https://use.typekit.net/af/86b539/00000000000000003b9b093a/27/a?subset_id=2&fvd=i7&v=3) format("opentype");font-weight:700;font-style:italic;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/a3eee8/00000000000000003b9b093c/27/l?subset_id=2&fvd=n8&v=3) format("woff2"),url(https://use.typekit.net/af/a3eee8/00000000000000003b9b093c/27/d?subset_id=2&fvd=n8&v=3) format("woff"),url(https://use.typekit.net/af/a3eee8/00000000000000003b9b093c/27/a?subset_id=2&fvd=n8&v=3) format("opentype");font-weight:800;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/e85210/00000000000000003b9b093d/27/l?subset_id=2&fvd=i8&v=3) format("woff2"),url(https://use.typekit.net/af/e85210/00000000000000003b9b093d/27/d?subset_id=2&fvd=i8&v=3) format("woff"),url(https://use.typekit.net/af/e85210/00000000000000003b9b093d/27/a?subset_id=2&fvd=i8&v=3) format("opentype");font-weight:800;font-style:italic;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/55bd39/00000000000000003b9b093f/27/l?subset_id=2&fvd=n9&v=3) format("woff2"),url(https://use.typekit.net/af/55bd39/00000000000000003b9b093f/27/d?subset_id=2&fvd=n9&v=3) format("woff"),url(https://use.typekit.net/af/55bd39/00000000000000003b9b093f/27/a?subset_id=2&fvd=n9&v=3) format("opentype");font-weight:900;font-style:normal;}@font-face{font-family:proxima-nova;src:url(https://use.typekit.net/af/8b7167/00000000000000003b9b093e/27/l?subset_id=2&fvd=i9&v=3) format("woff2"),url(https://use.typekit.net/af/8b7167/00000000000000003b9b093e/27/d?subset_id=2&fvd=i9&v=3) format("woff"),url(https://use.typekit.net/af/8b7167/00000000000000003b9b093e/27/a?subset_id=2&fvd=i9&v=3) format("opentype");font-weight:900;font-style:italic;}</style><script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<link rel="stylesheet" type="text/css" href="./Integrate Banana Phone scripts — Arctangent.io_files/css">
<script type="text/javascript">SQUARESPACE_ROLLUPS = {};</script>
<script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//static.squarespace.com/universal/scripts-compressed/common-a5b8c446f63325ada241-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common');</script>
<script crossorigin="anonymous" src="./Integrate Banana Phone scripts — Arctangent.io_files/common-a5b8c446f63325ada241-min.en-US.js"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//static.squarespace.com/universal/scripts-compressed/commerce-3efce416b0d0551420d7-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-commerce');</script>
<script crossorigin="anonymous" src="./Integrate Banana Phone scripts — Arctangent.io_files/commerce-3efce416b0d0551420d7-min.en-US.js"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].css = ["//static.squarespace.com/universal/styles-compressed/commerce-3cf2dee12bb4759d736dea53e6c346aa-min.css"]; })(SQUARESPACE_ROLLUPS, 'squarespace-commerce');</script>
<link rel="stylesheet" type="text/css" href="./Integrate Banana Phone scripts — Arctangent.io_files/commerce-3cf2dee12bb4759d736dea53e6c346aa-min.css"><script crossorigin="anonymous" src="./Integrate Banana Phone scripts — Arctangent.io_files/performance-9a584ae1b5ee39af2e98-min.en-US.js" defer=""></script><script data-name="static-context">Static = window.Static || {}; Static.SQUARESPACE_CONTEXT = {"facebookAppId":"314192535267336","rollups":{"squarespace-announcement-bar":{"css":"//static.squarespace.com/universal/styles-compressed/announcement-bar-d41d8cd98f00b204e9800998ecf8427e-min.css","js":"//static.squarespace.com/universal/scripts-compressed/announcement-bar-8dac5ea8db9ee2f1a64f-min.en-US.js"},"squarespace-audio-player":{"css":"//static.squarespace.com/universal/styles-compressed/audio-player-a57b8f3aa31918104f57a068648fbc63-min.css","js":"//static.squarespace.com/universal/scripts-compressed/audio-player-a98fd9ca7c506637848f-min.en-US.js"},"squarespace-blog-collection-list":{"css":"//static.squarespace.com/universal/styles-compressed/blog-collection-list-d41d8cd98f00b204e9800998ecf8427e-min.css","js":"//static.squarespace.com/universal/scripts-compressed/blog-collection-list-41b7317d14ee3981fa0b-min.en-US.js"},"squarespace-calendar-block-renderer":{"css":"//static.squarespace.com/universal/styles-compressed/calendar-block-renderer-9acef2d24c6a994fca1a8a82e99e19c3-min.css","js":"//static.squarespace.com/universal/scripts-compressed/calendar-block-renderer-949a97803f43b64a6a1c-min.en-US.js"},"squarespace-chartjs-helpers":{"css":"//static.squarespace.com/universal/styles-compressed/chartjs-helpers-9935a41d63cf08ca108505d288c1712e-min.css","js":"//static.squarespace.com/universal/scripts-compressed/chartjs-helpers-441567548b33178df40c-min.en-US.js"},"squarespace-comments":{"css":"//static.squarespace.com/universal/styles-compressed/comments-a7b26c9ae88684f76d210b61d0b0d848-min.css","js":"//static.squarespace.com/universal/scripts-compressed/comments-bc32d6345bffce234c36-min.en-US.js"},"squarespace-commerce-cart":{"js":"//static.squarespace.com/universal/scripts-compressed/commerce-cart-e49362b1601c7acfec8d-min.en-US.js"},"squarespace-dialog":{"css":"//static.squarespace.com/universal/styles-compressed/dialog-7ba230f290b5d21d9871eb06db23b5c9-min.css","js":"//static.squarespace.com/universal/scripts-compressed/dialog-30f662aeac6cfddf98da-min.en-US.js"},"squarespace-events-collection":{"css":"//static.squarespace.com/universal/styles-compressed/events-collection-9acef2d24c6a994fca1a8a82e99e19c3-min.css","js":"//static.squarespace.com/universal/scripts-compressed/events-collection-87426780aab2f3338afc-min.en-US.js"},"squarespace-form-rendering-utils":{"js":"//static.squarespace.com/universal/scripts-compressed/form-rendering-utils-da3eeda5a5cdbbbe32a5-min.en-US.js"},"squarespace-forms":{"css":"//static.squarespace.com/universal/styles-compressed/forms-ac7917c174031c937e3df4b3a2005b34-min.css","js":"//static.squarespace.com/universal/scripts-compressed/forms-32e6c8cfcc179803a2ae-min.en-US.js"},"squarespace-gallery-collection-list":{"css":"//static.squarespace.com/universal/styles-compressed/gallery-collection-list-d41d8cd98f00b204e9800998ecf8427e-min.css","js":"//static.squarespace.com/universal/scripts-compressed/gallery-collection-list-80e3ad4a928d8aed2507-min.en-US.js"},"squarespace-image-zoom":{"css":"//static.squarespace.com/universal/styles-compressed/image-zoom-72b0ab7796582588032aa6472e2e2f14-min.css","js":"//static.squarespace.com/universal/scripts-compressed/image-zoom-364b50d4f9aba0a21163-min.en-US.js"},"squarespace-pinterest":{"css":"//static.squarespace.com/universal/styles-compressed/pinterest-d41d8cd98f00b204e9800998ecf8427e-min.css","js":"//static.squarespace.com/universal/scripts-compressed/pinterest-1982ed2776a633ac6140-min.en-US.js"},"squarespace-popup-overlay":{"css":"//static.squarespace.com/universal/styles-compressed/popup-overlay-7b48efeab9b323dfdb524a256cf61595-min.css","js":"//static.squarespace.com/universal/scripts-compressed/popup-overlay-d1dc8411aea4b2d0b72b-min.en-US.js"},"squarespace-product-quick-view":{"css":"//static.squarespace.com/universal/styles-compressed/product-quick-view-bc8694b75a40e4bd969b662b80ebafb5-min.css","js":"//static.squarespace.com/universal/scripts-compressed/product-quick-view-bdd8cfffe173df8dfbae-min.en-US.js"},"squarespace-products-collection-item-v2":{"css":"//static.squarespace.com/universal/styles-compressed/products-collection-item-v2-72b0ab7796582588032aa6472e2e2f14-min.css","js":"//static.squarespace.com/universal/scripts-compressed/products-collection-item-v2-a6a32a04d13edb0a888f-min.en-US.js"},"squarespace-products-collection-list-v2":{"css":"//static.squarespace.com/universal/styles-compressed/products-collection-list-v2-72b0ab7796582588032aa6472e2e2f14-min.css","js":"//static.squarespace.com/universal/scripts-compressed/products-collection-list-v2-ac09cb918b138c11b6c8-min.en-US.js"},"squarespace-search-page":{"css":"//static.squarespace.com/universal/styles-compressed/search-page-ea3e98edb84abbc5e758884f69149027-min.css","js":"//static.squarespace.com/universal/scripts-compressed/search-page-b5175865491ea3c87447-min.en-US.js"},"squarespace-search-preview":{"js":"//static.squarespace.com/universal/scripts-compressed/search-preview-a7aa862cd423ac1991ad-min.en-US.js"},"squarespace-share-buttons":{"js":"//static.squarespace.com/universal/scripts-compressed/share-buttons-6b32919028926b43f0a8-min.en-US.js"},"squarespace-simple-liking":{"css":"//static.squarespace.com/universal/styles-compressed/simple-liking-310d0b18e112f708f91339b11fd55714-min.css","js":"//static.squarespace.com/universal/scripts-compressed/simple-liking-92605f7ba9ea6bcaf673-min.en-US.js"},"squarespace-social-buttons":{"css":"//static.squarespace.com/universal/styles-compressed/social-buttons-26106f808f7e9c739a7f862a408ed039-min.css","js":"//static.squarespace.com/universal/scripts-compressed/social-buttons-3c936e7bbb34d54c3cfc-min.en-US.js"},"squarespace-tourdates":{"css":"//static.squarespace.com/universal/styles-compressed/tourdates-d41d8cd98f00b204e9800998ecf8427e-min.css","js":"//static.squarespace.com/universal/scripts-compressed/tourdates-606469b17ba69a9b693e-min.en-US.js"},"squarespace-website-overlays-manager":{"css":"//static.squarespace.com/universal/styles-compressed/website-overlays-manager-df9cddfe3eca22764d10fd6fc4f4ad73-min.css","js":"//static.squarespace.com/universal/scripts-compressed/website-overlays-manager-36f38e521a77126f3760-min.en-US.js"}},"pageType":2,"website":{"id":"583dc6b829687f52b54693f1","identifier":"alex-ruiz-7fpx","websiteType":1,"contentModifiedOn":1493003659083,"cloneable":false,"siteStatus":{},"language":"en-US","timeZone":"America/Los_Angeles","machineTimeZoneOffset":-28800000,"timeZoneOffset":-28800000,"timeZoneAbbr":"PST","siteTitle":"Arctangent.io","fullSiteTitle":"Integrate Banana Phone scripts \u2014 Arctangent.io","siteTagLine":"","siteDescription":"","logoImageId":"583e7981d1758e46ff3ea301","shareButtonOptions":{"1":true,"6":true,"8":true,"4":true,"5":true,"3":true,"7":true},"logoImageUrl":"//static1.squarespace.com/static/583dc6b829687f52b54693f1/t/583e7981d1758e46ff3ea301/1493003659083/","authenticUrl":"https://www.arctangent.io","internalUrl":"https://alex-ruiz-7fpx.squarespace.com","baseUrl":"https://www.arctangent.io","primaryDomain":"www.arctangent.io","sslSetting":3,"socialAccounts":[{"serviceId":2,"userId":"1280898078611932","screenname":"Alex Ruiz","addedOn":1486425640746,"profileUrl":"https://www.facebook.com/276074649187125","iconUrl":"http://graph.facebook.com/1280898078611932/picture?type=square","metaData":{"service":"facebook"},"iconEnabled":true,"serviceName":"facebook"}],"typekitId":"","statsMigrated":false,"imageMetadataProcessingEnabled":false,"screenshotId":"daeda4c1","showOwnerLogin":false},"websiteSettings":{"id":"583dc6b829687f52b54693f3","websiteId":"583dc6b829687f52b54693f1","type":"Personal","subjects":[],"country":"US","state":"CA","simpleLikingEnabled":true,"mobileInfoBarSettings":{"style":1,"isContactEmailEnabled":false,"isContactPhoneNumberEnabled":false,"isLocationEnabled":false,"isBusinessHoursEnabled":false},"announcementBarSettings":{"style":1,"text":"<p><strong>Sign up to get project updates!</strong></p>","clickthroughUrl":{"url":"http://eepurl.com/cAAmCL","newWindow":false}},"commentLikesAllowed":true,"commentAnonAllowed":true,"commentThreaded":true,"commentApprovalRequired":false,"commentAvatarsOn":true,"commentSortType":2,"commentFlagThreshold":0,"commentFlagsAllowed":true,"commentEnableByDefault":true,"commentDisableAfterDaysDefault":0,"disqusShortname":"","commentsEnabled":true,"contactPhoneNumber":"","storeSettings":{"returnPolicy":null,"termsOfService":null,"privacyPolicy":null,"paymentSettings":{"stripeLivePublicApiKey":"pk_live_pGkV2ie3jk9H3lUgZSV8ihXm","stripeTestPublicApiKey":"pk_test_pIqYbJfDwvz0lLwqzqcsXNxM","stripeUserId":"acct_19ivPEKNSjMTkklF","stripeAccountCountry":"US"},"expressCheckout":false,"continueShoppingLinkUrl":"/","useLightCart":false,"showNoteField":false,"shippingCountryDefaultValue":"US","billToShippingDefaultValue":false,"showShippingPhoneNumber":true,"isShippingPhoneRequired":false,"showBillingPhoneNumber":true,"isBillingPhoneRequired":false,"multipleQuantityAllowedForServices":true,"currenciesSupported":["USD","AUD","CAD","CHF","DKK","EUR","GBP","HKD","MXN","NOK","NZD","SEK","SGD"],"defaultCurrency":"USD","selectedCurrency":"USD","measurementStandard":1,"showCustomCheckoutForm":false,"enableMailingListOptInByDefault":false,"sameAsRetailLocation":false,"isLive":true},"useEscapeKeyToLogin":true,"ssBadgeType":1,"ssBadgePosition":4,"ssBadgeVisibility":1,"ssBadgeDevices":1,"pinterestOverlayOptions":{"mode":"disabled"},"ampEnabled":false},"cookieSettings":{"isCookieBannerEnabled":false,"isRestrictiveCookiePolicyEnabled":false,"isRestrictiveCookiePolicyAbsolute":false,"cookieBannerText":"","cookieBannerTheme":"","cookieBannerVariant":"","cookieBannerPosition":"","cookieBannerCtaVariant":"","cookieBannerCtaText":""},"websiteCloneable":false,"collection":{"title":"Integrate Banana Phone scripts","id":"588fa131c534a5d2ea2e741e","fullUrl":"/integrate-banana-phone/","type":10},"subscribed":false,"appDomain":"squarespace.com","templateTweakable":true,"tweakJSON":{"outerPadding":"100px","pagePadding":"29px","product-gallery-auto-crop":"true","product-image-auto-crop":"false","topPadding":"80px"},"templateId":"50521cf884aeb45fa5cfdb80","pageFeatures":[1,2,4],"googleMapsStaticApiKey":"AIzaSyBQdch5IcgcQaKNG76sbMQv1MEBEKLeQ-8","impersonatedSession":false,"demoCollections":[{"collectionId":"56d73fa2c2ea51af9150397a","deleted":true},{"collectionId":"56d73faf07eaa0500957fd07","deleted":true},{"collectionId":"56d73ffc859fd045d0337663","deleted":true},{"collectionId":"56d748f301dbae7a6d77a085","deleted":true},{"collectionId":"56d748fd01dbae7a6d77a0ff","deleted":true},{"collectionId":"56d74904b6aa604e5dddc2d5","deleted":true},{"collectionId":"56d749d9f699bb41e6c05ac0","deleted":true},{"collectionId":"56d74a0145bf212e1e8fda87","deleted":true},{"collectionId":"56d74a4407eaa05009586c60","deleted":true},{"collectionId":"56d74b162b8dde44a009ea5b","deleted":true},{"collectionId":"56d74d8260b5e9a191ff9472","deleted":true},{"collectionId":"56d74e1a859fd045d0340c5a","deleted":true},{"collectionId":"56d74e9d9f7266eea24dcb08","deleted":true},{"collectionId":"56d74fac59827e4e2353b34b","deleted":true},{"collectionId":"56d75559c6fc0864a0e01ca0","deleted":true},{"collectionId":"56d75ee9746fb902cc96143a","deleted":true}],"isFacebookTab":false,"tzData":{"zones":[[-480,"US","P%sT",null]],"rules":{"US":[[1967,2006,null,"Oct","lastSun","2:00","0","S"],[1987,2006,null,"Apr","Sun>=1","2:00","1:00","D"],[2007,"max",null,"Mar","Sun>=8","2:00","1:00","D"],[2007,"max",null,"Nov","Sun>=1","2:00","0","S"]]}}};</script><script type="text/javascript"> SquarespaceFonts.loadViaContext(); Squarespace.load(window);</script><script type="application/ld+json">{"url":"https://www.arctangent.io","name":"Arctangent.io","description":"","image":"//static1.squarespace.com/static/583dc6b829687f52b54693f1/t/583e7981d1758e46ff3ea301/1493003659083/","@context":"http://schema.org","@type":"WebSite"}</script><!--[if gte IE 9]> <link rel="stylesheet" type="text/css" href="//static1.squarespace.com/static/sitecss/583dc6b829687f52b54693f1/8/50521cf884aeb45fa5cfdb80/583dc6b829687f52b54693f7/936-05142015/1486546993988/site.css?&filterFeatures=false&part=1"/><link rel="stylesheet" type="text/css" href="//static1.squarespace.com/static/sitecss/583dc6b829687f52b54693f1/8/50521cf884aeb45fa5cfdb80/583dc6b829687f52b54693f7/936-05142015/1486546993988/site.css?&filterFeatures=false&part=2"/><link rel="stylesheet" type="text/css" href="//static1.squarespace.com/static/sitecss/583dc6b829687f52b54693f1/8/50521cf884aeb45fa5cfdb80/583dc6b829687f52b54693f7/936-05142015/1486546993988/site.css?&filterFeatures=false&part=3"/><link rel="stylesheet" type="text/css" href="//static1.squarespace.com/static/sitecss/583dc6b829687f52b54693f1/8/50521cf884aeb45fa5cfdb80/583dc6b829687f52b54693f7/936-05142015/1486546993988/site.css?&filterFeatures=false&part=4"/><![endif]-->
<!--[if lt IE 9]><link rel="stylesheet" type="text/css" href="//static1.squarespace.com/static/sitecss/583dc6b829687f52b54693f1/8/50521cf884aeb45fa5cfdb80/583dc6b829687f52b54693f7/936-05142015/1486546993988/site.css?&filterFeatures=false&noMedia=true&part=1"/><link rel="stylesheet" type="text/css" href="//static1.squarespace.com/static/sitecss/583dc6b829687f52b54693f1/8/50521cf884aeb45fa5cfdb80/583dc6b829687f52b54693f7/936-05142015/1486546993988/site.css?&filterFeatures=false&noMedia=true&part=2"/><link rel="stylesheet" type="text/css" href="//static1.squarespace.com/static/sitecss/583dc6b829687f52b54693f1/8/50521cf884aeb45fa5cfdb80/583dc6b829687f52b54693f7/936-05142015/1486546993988/site.css?&filterFeatures=false&noMedia=true&part=3"/><link rel="stylesheet" type="text/css" href="//static1.squarespace.com/static/sitecss/583dc6b829687f52b54693f1/8/50521cf884aeb45fa5cfdb80/583dc6b829687f52b54693f7/936-05142015/1486546993988/site.css?&filterFeatures=false&noMedia=true&part=4"/><![endif]-->
<!--[if !IE]> --><link rel="stylesheet" type="text/css" href="./Integrate Banana Phone scripts — Arctangent.io_files/site.css"><!-- <![endif]-->
<script>Static.COOKIE_BANNER_CAPABLE = true;</script>
<!-- End of Squarespace Headers -->
  <script src="./Integrate Banana Phone scripts — Arctangent.io_files/site-bundle.js" type="text/javascript"></script>
</head>

<body class="show-products-category-navigation   page-borders-thick canvas-style-normal stack-navigation header-subtitle-custom banner-alignment-center blog-layout-center project-layout-left-sidebar thumbnails-on-open-page-show-all social-icon-style-round  hide-info-footer  hide-page-title hide-page-title-underline  hide-article-author   event-show-past-events event-thumbnails event-thumbnail-size-32-standard event-date-label  event-list-show-cats event-list-date event-list-time event-list-address   event-icalgcal-links  event-excerpts  event-item-back-link    product-list-titles-under product-list-alignment-center product-item-size-11-square  product-gallery-size-11-square product-gallery-auto-crop show-product-price show-product-item-nav product-social-sharing newsletter-style-dark hide-opentable-icons opentable-style-dark small-button-style-solid small-button-shape-square medium-button-style-solid medium-button-shape-square large-button-style-solid large-button-shape-square image-block-poster-text-alignment-center image-block-card-dynamic-font-sizing image-block-card-content-position-center image-block-card-text-alignment-left image-block-overlap-dynamic-font-sizing image-block-overlap-content-position-center image-block-overlap-text-alignment-left image-block-collage-dynamic-font-sizing image-block-collage-content-position-top image-block-collage-text-alignment-left image-block-stack-dynamic-font-sizing image-block-stack-text-alignment-left button-style-outline button-corner-style-square tweak-product-quick-view-button-style-floating tweak-product-quick-view-button-position-bottom tweak-product-quick-view-lightbox-excerpt-display-truncate tweak-product-quick-view-lightbox-show-arrows tweak-product-quick-view-lightbox-show-close-button tweak-product-quick-view-lightbox-controls-weight-light native-currency-code-usd collection-588fa131c534a5d2ea2e741e collection-type-page collection-layout-default mobile-style-available logo-image" id="collection-588fa131c534a5d2ea2e741e">

  <div id="canvas">

    <div id="mobileNav" class="">
      <div class="wrapper">
        <nav class="main-nav mobileNav"><ul>
  
    

        <li class="blog-collection">

          

            
              <a href="https://www.arctangent.io/">Dev Blog</a>
            

            


          

        </li>

    

        <li class="page-collection">

          

            
              <a href="https://www.arctangent.io/build-your-own/">Make Banana Phone</a>
            

            


          

        </li>

    

        <li class="page-collection">

          

            
              <a href="https://www.arctangent.io/contact/">Contact</a>
            

            


          

        </li>

    
    
  
</ul>
</nav>

      </div>
    </div>
    <div id="mobileMenuLink"><a>Menu</a></div>

    <header id="header" class="clear">

    

      <div id="upper-logo">
        <h1 class="logo" data-content-field="site-title">
          <a href="https://www.arctangent.io/"><img src="./Integrate Banana Phone scripts — Arctangent.io_files/saved_resource" alt="Arctangent.io"></a>
        </h1>
      </div>
      <script>
      if (parseInt(Y.one('body').getComputedStyle('width'),10) <= 640) {
        Y.use('squarespace-ui-base', function(Y) {
          Y.one("#upper-logo .logo").plug(Y.Squarespace.TextShrink, {
            parentEl: Y.one('#upper-logo')
          });
        });
      }
      </script>

      
      <div class="site-info" data-content-field="business-information">
        <div class="site-address">Street Address</div>
        <div class="site-city-state">City, State, Zip</div>
        <div class="site-phone">Phone Number</div>
      </div>
      

      <div class="site-tag-line">
        
      </div>

      <div class="custom-info">
        <div class="sqs-layout sqs-grid-12 columns-12" data-layout-label="Header Subtitle: Custom Content" data-type="block-field" data-updated-on="1480831935874" id="customInfoBlock"><div class="row sqs-row"><div class="col sqs-col-12 span-12"><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-81eee4bbda3d9efd0834"><div class="sqs-block-content"><h1 class="text-align-center">Have code. Will travel.</h1></div></div></div></div></div>
      </div>

      <div id="lower-logo">
        <h1 class="logo" data-content-field="site-title" data-shrink-original-size="46" style="letter-spacing: 0.0217391em;"><a href="https://www.arctangent.io/"><img src="./Integrate Banana Phone scripts — Arctangent.io_files/saved_resource" alt="Arctangent.io"></a></h1>
      </div>
      <script>
        Y.use('squarespace-ui-base', function(Y) {
          Y.one("#lower-logo .logo").plug(Y.Squarespace.TextShrink, {
            parentEl: Y.one('#lower-logo')
          });
        });
      </script>

    
      <div id="topNav">
  <nav class="main-nav" data-content-field="navigation">
    <ul>
    
      

          <li class="blog-collection">

            

              
                <a href="https://www.arctangent.io/">Dev Blog</a>
              

              


            

          </li>

      

          <li class="page-collection">

            

              
                <a href="https://www.arctangent.io/build-your-own/">Make Banana Phone</a>
              

              


            

          </li>

      

          <li class="page-collection">

            

              
                <a href="https://www.arctangent.io/contact/">Contact</a>
              

              


            

          </li>

      
      
    
  </ul>
  <div class="page-divider"></div>
  </nav>
</div>


    </header>

    <div class="page-divider top-divider"></div>

    <!-- // page image or divider -->
    
      
        
      
    

    <section id="page" class="clear" role="main" data-content-field="main-content" data-collection-id="588fa131c534a5d2ea2e741e" data-edit-main-image="Banner" style="opacity: 1;">

      <!-- // CATEGORY NAV -->
      

      <div class="sqs-layout sqs-grid-12 columns-12" data-type="page" data-updated-on="1487133727835" id="page-588fa131c534a5d2ea2e741e"><div class="row sqs-row" id="yui_3_17_2_1_1546885903013_117"><div class="col sqs-col-12 span-12" id="yui_3_17_2_1_1546885903013_116"><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-f269b6c57b65714a38ee"><div class="sqs-block-content"><h1 class="text-align-center">Integrate Banana Phone scripts</h1><p style="margin-left:40px">We now come to the conclusion of our Banana Phone build. The scripts are written in Python and will be stored in some new directories we will create within the 'banana' home directory. We'll then add the needed media files for Asterisk to play when a call is received, and finish out with setting up the database for remembering validated caller IDs and some test calls to make sure everything works.</p><h2>Banana Phone directory structure</h2></div></div><div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" id="block-yui_3_17_2_11_1485801441250_6125"><div class="sqs-block-content"><hr></div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_6524"><div class="sqs-block-content"><p style="margin-left: 40px;">We have a few Python scripts to copy into our 'banana' user's home directory, so we will make a few more to better organize things. Let's move into the 'banana' user's home directory and create some more.</p><p style="margin-left: 40px;">Login to your Asterisk server as 'banana', move into the'banana_phone' directory in 'banana' user's home directory and create the following:</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_10339"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020">cd</span> ~/banana_phone
mkdir audio_clips
mkdir audio_clips/slns
mkdir scripts
mkdir auth_audio
</pre></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_11056"><div class="sqs-block-content"><p style="margin-left: 40px;">Now move into the 'scripts' directory you just created.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_11934"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #007020">cd </span>scripts/
</pre></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_12507"><div class="sqs-block-content"><h2>Copy Banana Phone scripts</h2></div></div><div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" id="block-yui_3_17_2_11_1485801441250_13338"><div class="sqs-block-content"><hr></div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_13708"><div class="sqs-block-content"><p style="margin-left: 40px;">There are eight python scripts we must copy into our directory so Banana Phone will do it's job. They require some database work with SQLAlchemy, so we'll install that now.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_15332"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">sudo pip install sqlalchemy
</pre></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_15870"><div class="sqs-block-content"><p style="margin-left: 40px;">I'm gonna just list the python files for copying individually here. I won't go over what the scripts do in detail. That is left as an exercise for the reader.</p><h2 style="margin-left: 40px;">database_maps.py</h2><p style="margin-left: 40px;" dir="ltr">This defines our database tables within sqlalchemy for a basic call log and white list.&nbsp;</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_26274"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano database_maps<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_19512"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">datetime</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">sqlalchemy</span> <span style="color: #008800; font-weight: bold">import</span> create_engine, Column, Integer, String, DateTime
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">sqlalchemy.ext.declarative</span> <span style="color: #008800; font-weight: bold">import</span> declarative_base

Base <span style="color: #333333">=</span> declarative_base()

<span style="color: #888888"># define the whitelist table</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">WhiteList</span>(Base):
    __tablename__ <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'whitelist'</span>

    <span style="color: #007020">id</span> <span style="color: #333333">=</span> Column(Integer, primary_key<span style="color: #333333">=</span><span style="color: #007020">True</span>)
    number <span style="color: #333333">=</span> Column(Integer)
    timestamp <span style="color: #333333">=</span> Column(DateTime, default<span style="color: #333333">=</span>datetime<span style="color: #333333">.</span>datetime<span style="color: #333333">.</span>utcnow)

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__repr__</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="background-color: #fff0f0">"&lt;Whitelist CID: </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&gt;"</span> <span style="color: #333333">%</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>number

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">CallLog</span>(Base):
    __tablename__ <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'log'</span>

    <span style="color: #007020">id</span> <span style="color: #333333">=</span> Column(Integer, primary_key<span style="color: #333333">=</span><span style="color: #007020">True</span>)
    number <span style="color: #333333">=</span> Column(String)
    name <span style="color: #333333">=</span> Column(String)
    timestamp <span style="color: #333333">=</span> Column(DateTime, default<span style="color: #333333">=</span>datetime<span style="color: #333333">.</span>datetime<span style="color: #333333">.</span>utcnow)
   
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__repr__</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="background-color: #fff0f0">"&lt;Call Log entry: </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> - </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> - </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&gt;"</span> <span style="color: #333333">%</span> (<span style="color: #007020">self</span><span style="color: #333333">.</span>name, <span style="color: #007020">self</span><span style="color: #333333">.</span>number, <span style="color: #007020">self</span><span style="color: #333333">.</span>timestamp)
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_20206"><div class="sqs-block-content"><h2 style="margin-left: 40px;">database_helpers.py</h2><p style="margin-left: 40px;" dir="ltr">Contains a helper function for creating a session in sqlalchemy for needed database operations.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_28434"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano database_helpers<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_30108"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">sqlalchemy</span> <span style="color: #008800; font-weight: bold">import</span> create_engine
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">sqlalchemy.orm</span> <span style="color: #008800; font-weight: bold">import</span> sessionmaker

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">create_session</span>():
    engine <span style="color: #333333">=</span> create_engine(<span style="background-color: #fff0f0">'sqlite:////home/banana/banana_phone/banana_phone.db'</span>)
    Session <span style="color: #333333">=</span> sessionmaker(bind<span style="color: #333333">=</span>engine)
    session <span style="color: #333333">=</span> Session()
    session<span style="color: #333333">.</span>_model_changes <span style="color: #333333">=</span> {}
    <span style="color: #008800; font-weight: bold">return</span> session  
  
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_30643"><div class="sqs-block-content"><h2 style="margin-left:40px">setup_database.py</h2><p style="margin-left:40px">We will run this script to create up the sqlite database needed for storing the CallLog and WhiteList. Don't run this now.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_41032"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano setup_database.py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_32610"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">datetime</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">sqlalchemy</span> <span style="color: #008800; font-weight: bold">import</span> create_engine, Column, Integer, String, DateTime
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">sqlalchemy.ext.declarative</span> <span style="color: #008800; font-weight: bold">import</span> declarative_base
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">sqlalchemy.orm</span> <span style="color: #008800; font-weight: bold">import</span> sessionmaker
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_helpers</span> <span style="color: #008800; font-weight: bold">import</span> create_session

engine <span style="color: #333333">=</span> create_engine(<span style="background-color: #fff0f0">'sqlite:////home/banana/banana_phone/banana_phone.db'</span>, echo<span style="color: #333333">=</span><span style="color: #007020">True</span>)

<span style="color: #888888">#initiaize your Base for building models</span>
Base <span style="color: #333333">=</span> declarative_base()

<span style="color: #888888"># define the whitelist table</span>
<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">WhiteList</span>(Base):
    __tablename__ <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'whitelist'</span>

    <span style="color: #007020">id</span> <span style="color: #333333">=</span> Column(Integer, primary_key<span style="color: #333333">=</span><span style="color: #007020">True</span>)
    number <span style="color: #333333">=</span> Column(Integer)
    timestamp <span style="color: #333333">=</span> Column(DateTime, default<span style="color: #333333">=</span>datetime<span style="color: #333333">.</span>datetime<span style="color: #333333">.</span>utcnow)

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__repr__</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="background-color: #fff0f0">"&lt;Whitelist CID: </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&gt;"</span> <span style="color: #333333">%</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>number

<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">CallLog</span>(Base):
    __tablename__ <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'log'</span>

    <span style="color: #007020">id</span> <span style="color: #333333">=</span> Column(Integer, primary_key<span style="color: #333333">=</span><span style="color: #007020">True</span>)
    number <span style="color: #333333">=</span> Column(Integer)
    name <span style="color: #333333">=</span> Column(String)
    timestamp <span style="color: #333333">=</span> Column(DateTime, default<span style="color: #333333">=</span>datetime<span style="color: #333333">.</span>datetime<span style="color: #333333">.</span>utcnow)

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__repr__</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="background-color: #fff0f0">"&lt;Call Log entry: </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> - </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> - </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">&gt;"</span> <span style="color: #333333">%</span> (<span style="color: #007020">self</span><span style="color: #333333">.</span>name, <span style="color: #007020">self</span><span style="color: #333333">.</span>number, <span style="color: #007020">self</span><span style="color: #333333">.</span>timestamp)

Base<span style="color: #333333">.</span>metadata<span style="color: #333333">.</span>create_all(engine)
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_42216"><div class="sqs-block-content"><h2 style="margin-left: 40px;">CID_helpers.py</h2><p style="margin-left: 40px;" dir="ltr">These are a collection of <em>simple</em> data validation functions for incoming caller ID numbers from Asterisk.</p><p style="margin-left: 40px;" dir="ltr">It is by no means extensive, but it covers that basics and is pretty simple to follow</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_43963"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano CID_helpers.py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_44519"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">re</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">valid_digits</span>( cid ):
    <span style="color: #888888">###################################################</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># --- check incoming caller ID only contains digits</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># input: caller ID string from Asterisk </span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># output: boolean </span>
    <span style="color: #888888">#</span>
    <span style="color: #888888">####################################################</span>

    <span style="color: #888888"># ensure var is string</span>
    str_cid <span style="color: #333333">=</span> <span style="color: #007020">str</span>(cid)
    <span style="color: #888888">#print str_cid</span>

    <span style="color: #888888"># if valid digit string, return true</span>
    <span style="color: #008800; font-weight: bold">if</span> str_cid<span style="color: #333333">.</span>isdigit():
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>
    <span style="color: #008800; font-weight: bold">else</span>:
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">cid_visible</span>( cid ):
    <span style="color: #888888">#######################################</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># --- check if caller ID is present ---</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># input: caller ID string from Asterisk</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># output: boolean</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888">#######################################</span>

    <span style="color: #888888"># print cid</span>

    <span style="color: #888888"># ensure var is string</span>
    str_cid <span style="color: #333333">=</span> <span style="color: #007020">str</span>(cid)

    <span style="color: #008800; font-weight: bold">if</span> (str_cid <span style="color: #333333">==</span> <span style="background-color: #fff0f0">"Unknown"</span>):
        <span style="color: #888888">#print "Blank CID - do not save"</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>
    <span style="color: #008800; font-weight: bold">elif</span> (str_cid <span style="color: #333333">==</span> <span style="background-color: #fff0f0">''</span>):
        <span style="color: #888888">#print "blank CID - actual blank string is registered for number - weird"</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>
    <span style="color: #008800; font-weight: bold">else</span>:
        <span style="color: #888888">#print "CID is present"</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">valid_length</span>( cid ):
    <span style="color: #888888">#####################################################</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># --- check that caller ID is the correct length ---</span>
    <span style="color: #888888"># either 7, 10 or 11 digits only</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># input: caller ID string from Asterisk</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># output:  boolean</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888">#####################################################</span>

    <span style="color: #888888"># print cid</span>

    <span style="color: #888888"># ensure var is string</span>
    <span style="color: #888888">#     </span>

    <span style="color: #008800; font-weight: bold">if</span> (<span style="color: #007020">len</span>(cid) <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">7</span>):
        <span style="color: #888888">#print "valid CID length - 7 digits, local number"</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>
    <span style="color: #008800; font-weight: bold">elif</span> (<span style="color: #007020">len</span>(cid) <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">11</span>):
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>
    <span style="color: #008800; font-weight: bold">elif</span> (<span style="color: #007020">len</span>(cid) <span style="color: #333333">==</span> <span style="color: #0000DD; font-weight: bold">10</span>):
        <span style="color: #888888">#print "valid CID length - 10 digits, full number"</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>
    <span style="color: #008800; font-weight: bold">else</span>:
        <span style="color: #888888">#print "number is not standard, probs fake: length is %s" % (len(cid))</span>
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">non_repeating_cid</span>( cid ):
    <span style="color: #888888">##################################################################</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># --- check repeating numbers in phone number ---</span>
    <span style="color: #888888"># ex. "(111) 111-1111</span>
    <span style="color: #888888"># </span>
    <span style="color: #888888"># input: caller ID string from Asterisk</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888"># output: boolean</span>
    <span style="color: #888888">#</span>
    <span style="color: #888888">#################################################################</span>

    <span style="color: #888888"># ensure var is string</span>
    str_cid <span style="color: #333333">=</span> <span style="color: #007020">str</span>(cid)

    searchObj <span style="color: #333333">=</span> re<span style="color: #333333">.</span>search(<span style="background-color: #fff0f0">r'\b(\d)\1+\b'</span>, str_cid)
    <span style="color: #888888"># if returns, cid is repeating number, throw false</span>
    <span style="color: #008800; font-weight: bold">if</span> searchObj:
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>
    <span style="color: #008800; font-weight: bold">else</span>:
        <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_54671"><div class="sqs-block-content"><h2 style="margin-left: 40px;">verify_CID.py</h2><p style="margin-left: 40px;" dir="ltr">This script validates that a caller ID looks legit enough to be put on the WhiteList. It's used after the call passes the human test.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_56872"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano verify_CID.py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_58556"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">argparse</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">CID_helpers</span> <span style="color: #008800; font-weight: bold">import</span> <span style="color: #333333">*</span>

parser <span style="color: #333333">=</span> argparse<span style="color: #333333">.</span>ArgumentParser()
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"cid"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"incoming caller id"</span>)
args <span style="color: #333333">=</span> parser<span style="color: #333333">.</span>parse_args()

<span style="color: #888888">#####################################</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># --- check all the CID helpers ---</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># if they all are true, the CID is good for saving</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># input: caller ID string from Asterisk</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># output: text string "YES" or "NO"</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># --- if this output look weird, it's because it totally is. In order to </span>
<span style="color: #888888"># --- "massage" Asterisk into being scripted from the dialplan, we print out strings</span>
<span style="color: #888888"># --- and use the Shell() application in the dialplan to extract the echoed string </span>
<span style="color: #888888"># --- to return the value into a dialplan variable.</span>
<span style="color: #888888"># ---</span>
<span style="color: #888888"># --- This is way stable and I opted for this because shitty AGI locks up </span>
<span style="color: #888888">#  </span>
<span style="color: #888888">#####################################</span>

incoming_cid <span style="color: #333333">=</span> args<span style="color: #333333">.</span>cid


visible_number <span style="color: #333333">=</span> cid_visible(incoming_cid)

good_length <span style="color: #333333">=</span> valid_length(incoming_cid)

all_digits <span style="color: #333333">=</span> valid_digits(incoming_cid)

non_repeat <span style="color: #333333">=</span> non_repeating_cid(incoming_cid)


<span style="color: #008800; font-weight: bold">if</span> visible_number <span style="color: #000000; font-weight: bold">and</span> good_length <span style="color: #000000; font-weight: bold">and</span> all_digits <span style="color: #000000; font-weight: bold">and</span> non_repeat:
    <span style="color: #008800; font-weight: bold">print</span> <span style="background-color: #fff0f0">'YES'</span>
<span style="color: #008800; font-weight: bold">else</span>:
    <span style="color: #008800; font-weight: bold">print</span> <span style="background-color: #fff0f0">'NO'</span>
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_59605"><div class="sqs-block-content"><h2 style="margin-left:40px">add_log.py</h2><p style="margin-left:40px">This saves caller ID info and time it came in to the CallLog table. We don't use it directly in any of the Banana Phone dialplan, but I can't leave this obvious feature out. You should always keep logs.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_62281"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano add_log<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_62826"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">argparse</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">datetime</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">CID_helpers</span> <span style="color: #008800; font-weight: bold">import</span> <span style="color: #333333">*</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_maps</span> <span style="color: #008800; font-weight: bold">import</span> CallLog
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_helpers</span> <span style="color: #008800; font-weight: bold">import</span> create_session

<span style="color: #888888">###################################################</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># --- add caller ID string to CallLog ---</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># input: caller ID number, caller ID name, epoch timestamp of call</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># output: will show a string rep of the record that's saved in the Asterisk debug console</span>
<span style="color: #888888">#</span>
<span style="color: #888888">################################################### </span>


<span style="color: #888888"># prep cli args for use</span>
parser <span style="color: #333333">=</span> argparse<span style="color: #333333">.</span>ArgumentParser()
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"cid"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"incoming caller id"</span>)
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"name"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"incoming caller name"</span>)
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"timestamp"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"call timestamp"</span>)
args <span style="color: #333333">=</span> parser<span style="color: #333333">.</span>parse_args()

cid_value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">''</span>
name_value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">''</span>
call_time <span style="color: #333333">=</span> datetime<span style="color: #333333">.</span>datetime<span style="color: #333333">.</span>fromtimestamp(<span style="color: #007020">float</span>(args<span style="color: #333333">.</span>timestamp))
<span style="color: #888888">#print call_time</span>

<span style="color: #888888">#check for blank cid, if so, put in filler string for logs</span>
shown_cid <span style="color: #333333">=</span> cid_visible(args<span style="color: #333333">.</span>cid)
<span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> shown_cid:
    cid_value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'No Caller ID'</span>
<span style="color: #008800; font-weight: bold">else</span>:
    cid_value <span style="color: #333333">=</span> args<span style="color: #333333">.</span>cid

<span style="color: #888888"># check for blank name, fill if blank</span>
<span style="color: #008800; font-weight: bold">if</span> args<span style="color: #333333">.</span>name <span style="color: #333333">==</span> <span style="background-color: #fff0f0">''</span>:
    name_value <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'No Name'</span>
<span style="color: #008800; font-weight: bold">else</span>:
    name_value <span style="color: #333333">=</span> args<span style="color: #333333">.</span>name

<span style="color: #008800; font-weight: bold">print</span> <span style="background-color: #fff0f0">"entry for log: </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> - </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> - </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">"</span> <span style="color: #333333">%</span> (cid_value, name_value, call_time)

<span style="color: #008800; font-weight: bold">try</span>:
    session <span style="color: #333333">=</span> create_session()
    <span style="color: #888888">#create a call log entry obj</span>
    log_add <span style="color: #333333">=</span> CallLog(number<span style="color: #333333">=</span>cid_value, name<span style="color: #333333">=</span>name_value, timestamp<span style="color: #333333">=</span>call_time)
    session<span style="color: #333333">.</span>add(log_add)
    session<span style="color: #333333">.</span>commit()
<span style="color: #008800; font-weight: bold">except</span> <span style="color: #FF0000; font-weight: bold">Exception</span> <span style="color: #008800; font-weight: bold">as</span> e:
    <span style="color: #008800; font-weight: bold">print</span> e
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_63451"><div class="sqs-block-content"><h2 style="margin-left: 40px;">add_whitelist.py</h2><p style="margin-left: 40px;" dir="ltr">This adds a caller ID string to the WhiteList table. This is called after the verify_CID script is run to ensure the CID being added is clean.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_65031"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano add_whitelist<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_68983"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">datetime</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">argparse</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_maps</span> <span style="color: #008800; font-weight: bold">import</span> WhiteList
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_helpers</span> <span style="color: #008800; font-weight: bold">import</span> create_session

<span style="color: #888888">###########################################</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># --- add caller ID to WhiteList table ---</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># input: caller ID number, call timestamp</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># output: nothing unless there is an error</span>
<span style="color: #888888">#</span>
<span style="color: #888888">###########################################</span>

parser <span style="color: #333333">=</span> argparse<span style="color: #333333">.</span>ArgumentParser()
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"cid"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"incoming caller id"</span>)
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"timestamp"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"call timestamp"</span>)
args <span style="color: #333333">=</span> parser<span style="color: #333333">.</span>parse_args()

call_time <span style="color: #333333">=</span> datetime<span style="color: #333333">.</span>datetime<span style="color: #333333">.</span>fromtimestamp(<span style="color: #007020">float</span>(args<span style="color: #333333">.</span>timestamp))

<span style="color: #008800; font-weight: bold">try</span>:
    session <span style="color: #333333">=</span> create_session()
    <span style="color: #888888">#create a white list entry obj</span>
    number_add <span style="color: #333333">=</span> WhiteList(number<span style="color: #333333">=</span>args<span style="color: #333333">.</span>cid, timestamp<span style="color: #333333">=</span>call_time)
    <span style="color: #888888">#print number_add</span>
    <span style="color: #888888"># add to white list</span>
    session<span style="color: #333333">.</span>add(number_add)
    session<span style="color: #333333">.</span>commit()
<span style="color: #008800; font-weight: bold">except</span> <span style="color: #FF0000; font-weight: bold">Exception</span> <span style="color: #008800; font-weight: bold">as</span> e:
    <span style="color: #008800; font-weight: bold">print</span> e
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_69560"><div class="sqs-block-content"><h2 style="margin-left: 40px;">check_whitelist.py</h2><p style="margin-left: 40px;" dir="ltr">This does exactly what it sounds like: takes a caller ID number as input, says if it's in the whitelist or not.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_70757"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano check_whitelist<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_11_1485801441250_71305"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">argparse</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_maps</span> <span style="color: #008800; font-weight: bold">import</span> WhiteList
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_helpers</span> <span style="color: #008800; font-weight: bold">import</span> create_session

<span style="color: #888888">##############################################</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># --- checks if caller ID is on WhiteList ---</span>
<span style="color: #888888"># </span>
<span style="color: #888888"># input: caller ID string from Asterisk</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># output: string "YES" or "NO"</span>
<span style="color: #888888">#</span>
<span style="color: #888888">#############################################</span>

parser <span style="color: #333333">=</span> argparse<span style="color: #333333">.</span>ArgumentParser()
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"cid"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"incoming caller id"</span>)
args <span style="color: #333333">=</span> parser<span style="color: #333333">.</span>parse_args()

<span style="color: #008800; font-weight: bold">try</span>:
    session <span style="color: #333333">=</span> create_session()
    check_wl <span style="color: #333333">=</span> session<span style="color: #333333">.</span>query(WhiteList)<span style="color: #333333">.</span>filter_by(number<span style="color: #333333">=</span>args<span style="color: #333333">.</span>cid)<span style="color: #333333">.</span>first()
<span style="color: #008800; font-weight: bold">except</span> <span style="color: #FF0000; font-weight: bold">Exception</span> <span style="color: #008800; font-weight: bold">as</span> e:
    <span style="color: #008800; font-weight: bold">print</span> e

<span style="color: #008800; font-weight: bold">if</span> check_wl <span style="color: #000000; font-weight: bold">is</span> <span style="color: #007020">None</span>:
    <span style="color: #008800; font-weight: bold">print</span> <span style="background-color: #fff0f0">"NO"</span>
<span style="color: #008800; font-weight: bold">else</span>:
    <span style="color: #008800; font-weight: bold">print</span> <span style="background-color: #fff0f0">"YES"</span>
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_11_1485801441250_86483"><div class="sqs-block-content"><h2 style="margin-left: 40px;">generate_auth_audio.py</h2><p style="margin-left: 40px;" dir="ltr">Banana Phone generates audio clips with random 4-digit passwords embedded in them. The first part of that process starts with generating the 4-digit code audio and saving it to a place for later retrieval.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_3_1485893675189_21225"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano generate_auth_audio<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_3_1485893675189_24687"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">subprocess</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">argparse</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">os</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">random</span> <span style="color: #008800; font-weight: bold">import</span> randint


<span style="color: #888888">####################################################################</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># --- generate a sox string command to create an </span>
<span style="color: #888888"># --- audio file containing a randomly generated 4-digit code</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># input: timestamp of call in epoch format, 4 digit integer</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># output: string containing a sox command to mix together </span>
<span style="color: #888888"># a new file from Asterisk audio resources</span>
<span style="color: #888888">#</span>
<span style="color: #888888">#####################################################################</span>

parser <span style="color: #333333">=</span> argparse<span style="color: #333333">.</span>ArgumentParser()
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"timestamp"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"incoming caller id"</span>)
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"auth"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"auth code"</span>)
args <span style="color: #333333">=</span> parser<span style="color: #333333">.</span>parse_args()

<span style="color: #888888">#print '--------'</span>
<span style="color: #888888">#print args.timestamp</span>
ts_file <span style="color: #333333">=</span> args<span style="color: #333333">.</span>timestamp <span style="color: #333333">+</span> <span style="background-color: #fff0f0">'.sln'</span>
<span style="color: #888888">#print 'timestamp file: ' + ts_file </span>
<span style="color: #888888">#print '--------'</span>
<span style="color: #888888">#print args.auth</span>

audio_dir <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'/home/banana/banana_phone/audio_clips/slns'</span>
auth_audio_dir <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'/home/banana/banana_phone/auth_audio'</span>
<span style="color: #888888">#file name tuples</span>
digits_tup <span style="color: #333333">=</span> (<span style="background-color: #fff0f0">'0.sln'</span>, <span style="background-color: #fff0f0">'1.sln'</span>, <span style="background-color: #fff0f0">'2.sln'</span>, <span style="background-color: #fff0f0">'3.sln'</span>, <span style="background-color: #fff0f0">'4.sln'</span>, <span style="background-color: #fff0f0">'5.sln'</span>, <span style="background-color: #fff0f0">'6.sln'</span>, <span style="background-color: #fff0f0">'7.sln'</span>, <span style="background-color: #fff0f0">'8.sln'</span>, <span style="background-color: #fff0f0">'9.sln'</span>)


<span style="color: #888888"># empty list for holding generated strings</span>
file_list <span style="color: #333333">=</span> []
<span style="color: #888888"># convert auth int into string</span>
auth_code <span style="color: #333333">=</span> <span style="color: #007020">str</span>(args<span style="color: #333333">.</span>auth)

<span style="color: #888888">#loop through auth password, adding files to list for sox to work on</span>
<span style="color: #008800; font-weight: bold">for</span> num <span style="color: #000000; font-weight: bold">in</span> auth_code[:<span style="color: #0000DD; font-weight: bold">4</span>]:
    path <span style="color: #333333">=</span> os<span style="color: #333333">.</span>path<span style="color: #333333">.</span>join(audio_dir, digits_tup[<span style="color: #007020">int</span>(num)])
    file_list<span style="color: #333333">.</span>append(path)

final_path <span style="color: #333333">=</span> os<span style="color: #333333">.</span>path<span style="color: #333333">.</span>join(auth_audio_dir, ts_file)

<span style="color: #888888">#print "final output path: " + final_path</span>

<span style="color: #888888"># assemble the final sox command</span>
cmd_string <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'sox </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">'</span> <span style="color: #333333">%</span> (silence_path, file_list[<span style="color: #0000DD; font-weight: bold">0</span>], file_list[<span style="color: #0000DD; font-weight: bold">1</span>], 
                                       file_list[<span style="color: #0000DD; font-weight: bold">2</span>], file_list[<span style="color: #0000DD; font-weight: bold">3</span>], final_path)

<span style="color: #888888"># print out string for SHELL() to extract into dialplan</span>
<span style="color: #008800; font-weight: bold">print</span> cmd_string
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_3_1485893675189_25301"><div class="sqs-block-content"><h2 style="margin-left: 40px;">generate_background_audio.py</h2><p style="margin-left: 40px;" dir="ltr">Once the auth code audio file is created, this script mixes that in with background music and drops it to the 'asterisk_resource' folder.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_3_1485893675189_26742"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano generate_background_audio<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_3_1485893675189_27282"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">argparse</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">os</span>
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">random</span> <span style="color: #008800; font-weight: bold">import</span> randint

<span style="color: #888888">###################################################################</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># --- mixes the auth code sound file over background music ---</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># input: timestamp of current call</span>
<span style="color: #888888">#</span>
<span style="color: #888888"># output: string with sox command for mixing audio files,</span>
<span style="color: #888888">#         drops file in custom asterisk sound directory</span>
<span style="color: #888888">#</span>
<span style="color: #888888">###################################################################</span>

parser <span style="color: #333333">=</span> argparse<span style="color: #333333">.</span>ArgumentParser()
parser<span style="color: #333333">.</span>add_argument(<span style="background-color: #fff0f0">"timestamp"</span>, help<span style="color: #333333">=</span><span style="background-color: #fff0f0">"incoming caller id"</span>)
args <span style="color: #333333">=</span> parser<span style="color: #333333">.</span>parse_args()

ts_file <span style="color: #333333">=</span> args<span style="color: #333333">.</span>timestamp <span style="color: #333333">+</span> <span style="background-color: #fff0f0">'.sln'</span>
audio_dir <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'/home/banana/banana_phone/audio_clips/slns'</span>
auth_audio_dir <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'/home/banana/banana_phone/auth_audio'</span>
final_audio_dir <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'/home/banana/banana_phone/asterisk_resources/sounds'</span>

bk_tup <span style="color: #333333">=</span> (<span style="background-color: #fff0f0">'bk_0.sln'</span>, <span style="background-color: #fff0f0">'bk_1.sln'</span>, <span style="background-color: #fff0f0">'bk_2.sln'</span>)

<span style="color: #888888"># empty list for holding generated strings</span>
file_list <span style="color: #333333">=</span> []

<span style="color: #888888"># pick a number 0 - 3, use that as the background audio</span>
bk_choice <span style="color: #333333">=</span> randint(<span style="color: #0000DD; font-weight: bold">0</span>,<span style="color: #0000DD; font-weight: bold">2</span>)
bk_path <span style="color: #333333">=</span> os<span style="color: #333333">.</span>path<span style="color: #333333">.</span>join(audio_dir, bk_tup[bk_choice])

final_path <span style="color: #333333">=</span> os<span style="color: #333333">.</span>path<span style="color: #333333">.</span>join(final_audio_dir, ts_file)

auth_audio_file <span style="color: #333333">=</span> os<span style="color: #333333">.</span>path<span style="color: #333333">.</span>join(auth_audio_dir, ts_file)

<span style="color: #888888"># assemble command string and print out for Shell() extraction </span>
cmd_string <span style="color: #333333">=</span> <span style="background-color: #fff0f0">'sox -m </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0"> </span><span style="background-color: #eeeeee">%s</span><span style="background-color: #fff0f0">'</span> <span style="color: #333333">%</span> (bk_path, auth_audio_file, final_path)
<span style="color: #008800; font-weight: bold">print</span> cmd_string
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_3_1485893675189_27866"><div class="sqs-block-content"><h2 style="margin-left: 40px;">show_log.py</h2><p style="margin-left: 40px;">This isn't used in the actual Banana Phone logic, but it's a nice little utility script for checking that our CallLog table is being written to correctly.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_3_1485893675189_29451"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">nano show_log<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_3_1485893675189_31258"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_maps</span> <span style="color: #008800; font-weight: bold">import</span> CallLog
<span style="color: #008800; font-weight: bold">from</span> <span style="color: #0e84b5; font-weight: bold">database_helpers</span> <span style="color: #008800; font-weight: bold">import</span> create_session

<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">log_dump</span>():
    session <span style="color: #333333">=</span> create_session()
    check_wl <span style="color: #333333">=</span> session<span style="color: #333333">.</span>query(CallLog)<span style="color: #333333">.</span>all()
    <span style="color: #008800; font-weight: bold">return</span> check_wl

log <span style="color: #333333">=</span> log_dump()

<span style="color: #008800; font-weight: bold">for</span> entry <span style="color: #000000; font-weight: bold">in</span> log:
    <span style="color: #008800; font-weight: bold">print</span> entry
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_3_1485893675189_31830"><div class="sqs-block-content"><p style="margin-left:40px">With a few quick modifications, this script can be used to dump the whitelist entries as well.&nbsp; Just replace every reference to "CallLog" with "WhiteList"</p><h2>Run setup_database.py</h2></div></div><div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" id="block-yui_3_17_2_3_1485893675189_72265"><div class="sqs-block-content"><hr></div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_3_1485893675189_79098"><div class="sqs-block-content"><p style="margin-left:40px">In the same 'scripts' directory, run the setup_database script.</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_3_1485893675189_80261"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">python setup_database<span style="color: #333333">.</span>py
</pre></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_3_1485893675189_81431"><div class="sqs-block-content"><p style="margin-left:40px">You should now have a database file in the 'banana_phone' directory that will contain our CallLog and WhiteList database records.</p><h2>Database file and directory permissions</h2></div></div><div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" id="block-yui_3_17_2_3_1485893675189_89377"><div class="sqs-block-content"><hr></div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_3_1485893675189_73471"><div class="sqs-block-content"><p style="margin-left:40px">Banana Phone uses Sqlite as it's database for storing call logs and the whitelist. Sqlite requires that the parent folder of the database file also be writable.</p><p style="margin-left:40px">I didn't wanna deal with making weird groups and all that bebop, I just set the 'banana_phone' directory and the database files' permissions to 777 (boo, hiss).</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_3_1485893675189_85374"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">chmod <span style="color: #0000DD; font-weight: bold">777</span> <span style="color: #333333">/</span>home<span style="color: #333333">/</span>banana<span style="color: #333333">/</span>banana_phone<span style="color: #333333">/</span>banana_phone<span style="color: #333333">.</span>db
chmod <span style="color: #0000DD; font-weight: bold">777</span> <span style="color: #333333">/</span>home<span style="color: #333333">/</span>banana<span style="color: #333333">/</span>banana_phone
</pre></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_3_1485893675189_88283"><div class="sqs-block-content"><h2>Audio files for Banana Phone</h2></div></div><div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" id="block-yui_3_17_2_3_1485893675189_90910"><div class="sqs-block-content"><hr></div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_3_1485893675189_93736"><div class="sqs-block-content"><p style="margin-left:40px">In my<a href="https://youtu.be/ovaWvFQgrqU?t=182"> original prototype</a>, I used a sound clip from that<a href="https://youtu.be/CPW9WN5hbUA?t=3"> famous video</a> from the Internet days of yore.</p><p style="margin-left:40px">I don't think I can legally hand out copies of that song on my site, so we're just gonna use some royalty-free music courtesy of<a href="http://www.bensound.com/royalty-free-music/corporate-pop"> Bensound.com</a> for the background music.</p><p style="margin-left:40px">We also need some sound clips of the numbers 0 -9, and some explanatory intro speech and instructional speech, so I used Google's free Text-to-Speech service courtesy of <a href="http://soundoftext.com/">soundoftext.com</a> for those files.</p><p style="margin-left:40px">Download and place the following files in the <strong>/home/banana/banana_phone/audio_clips/slns</strong> directory we made earlier:</p><ul style="margin-left:200px"><li><h3><strong><a href="https://www.arctangent.io/s/0.sln">0.sln</a></strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/1.sln">1.sln</a></strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/2.sln">2.sln</a></strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/3.sln">3.sln</a></strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/4.sln">4.sln</a></strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/5.sln">5.sln</a></strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/6.sln">6.sln</a></strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/7.sln">7.sln</a></strong></h3></li><li><h3><strong>8.sln</strong></h3></li><li><h3><strong>9.sln</strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/bk_0.sln">bk_0.sln</a></strong></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/bk_1.sln">bk_1.sln</a></strong></h3></li><li><h3><a href="https://www.arctangent.io/s/bk_2.sln"><strong>bk_2.sln</strong></a></h3></li><li><h3><strong><a href="https://www.arctangent.io/s/silence.sln">silence.sln</a></strong></h3></li></ul><p style="margin-left:40px">Place the following files in the <strong>/home/banana/banana_phone/asterisk_resources/sounds</strong></p><ul style="margin-left:200px"><li><h3><a href="https://www.arctangent.io/s/announcement.sln"><strong>announcement.sln</strong></a></h3></li><li><h3><a href="https://www.arctangent.io/s/initial_greet.sln"><strong>initial_greet.sln</strong></a></h3></li><li><h3><a href="https://www.arctangent.io/s/at_the_tone.sln"><strong>at_the_tone.sln</strong></a></h3></li><li><h3><a href="https://www.arctangent.io/s/only_once.sln"><strong>only_once.sln</strong></a></h3></li><li><h3><a href="https://www.arctangent.io/s/verified.sln"><strong>verified.sln</strong></a></h3></li></ul><p style="margin-left:40px">Make sure they're all owned by the 'banana' user.</p><h2>The Banana Phone dialplan</h2></div></div><div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" id="block-yui_3_17_2_3_1485893675189_148174"><div class="sqs-block-content"><hr></div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_4_1486061764369_25401"><div class="sqs-block-content"><p style="margin-left: 40px;">This is where all Asterisk and our database scripts all come together to create our robocall blocker.</p><p style="margin-left: 40px;">Here is a flow chart showing the logic flow for the Banana Phone dialplan.</p><p style="margin-left: 40px;">&nbsp;</p></div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_4_1486061764369_27225"><div class="sqs-block-content" id="yui_3_17_2_1_1546885903013_115">

  

  	
      <div class="image-block-outer-wrapper layout-caption-below design-layout-inline   " id="yui_3_17_2_1_1546885903013_114">
      
        <div class="intrinsic" style="max-width:456.0px;" id="yui_3_17_2_1_1546885903013_113">
          
            <div style="padding-bottom: 347.588%; overflow: hidden;" class="image-block-wrapper lightbox  has-aspect-ratio" data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1546885903013_112">
              <noscript><img src="https://static1.squarespace.com/static/583dc6b829687f52b54693f1/t/5893997dbe6594ef24d3cb63/1486068118396/banana_phone_flowchart" alt="banana_phone_flowchart" /></noscript><img class="thumb-image loaded" data-src="https://static1.squarespace.com/static/583dc6b829687f52b54693f1/t/5893997dbe6594ef24d3cb63/1486068118396/banana_phone_flowchart" data-image="https://static1.squarespace.com/static/583dc6b829687f52b54693f1/t/5893997dbe6594ef24d3cb63/1486068118396/banana_phone_flowchart" data-image-dimensions="456x1585" data-image-focal-point="0.5,0.5" data-load="false" data-image-id="5893997dbe6594ef24d3cb63" data-type="image" data-position-mode="standard" alt="banana_phone_flowchart" src="./Integrate Banana Phone scripts — Arctangent.io_files/banana_phone_flowchart" style="left: 0%; top: 0%; width: 100%; height: 100%; position: absolute;" data-image-resolution="500w">
            </div>
          

          

        </div>
      
      </div>
    

  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_4_1486061764369_28556"><div class="sqs-block-content"><p style="margin-left:40px">I'm not doing any techno-sorcery here. It's really that simple.</p><p style="margin-left:40px">Now actually getting Asterisk to do all those tricks is another story.</p><p style="margin-left:40px">Asterisk has enough input flexibility within it's dialplan applications to where we can get programmatic call control without using AGI or AMI. And that's great, because the dialplan is the most stable programming option of the three.</p><p style="margin-left:40px"><strong>* Please note: </strong>commands on the dialplan are meant to be on single lines, but the code highlighting generator I used put some of the longer ones on two lines. Just put them as single lines. Lines like 22/23, 25/26, 27/28, 49/50, etc. are supposed to be one line</p><p style="margin-left:40px">Now here's the code for the Banana Phone dialplan. Open up <strong>/etc/asterisk/extensions.conf </strong>and replace our original, minimalist dialplan with this:</p></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_4_1486061764369_32936"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tbody><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #333333">[</span>globals<span style="color: #333333">]</span>
<span style="color: #996633">APP_DIR</span><span style="color: #333333">=</span>/home/banana/banana_phone/
<span style="color: #996633">SCRIPTS_DIR</span><span style="color: #333333">=</span>/home/banana/banana_phone/scripts/

<span style="color: #333333">[</span>general<span style="color: #333333">]</span>
<span style="color: #996633">exten</span> <span style="color: #333333">=</span>&gt; _X.,1,Answer<span style="color: #333333">()</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"generic catch-all extension"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">EXTEN</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,HangUp<span style="color: #333333">()</span>

<span style="color: #333333">[</span>PhoneHandset<span style="color: #333333">]</span>
<span style="color: #996633">exten</span> <span style="color: #333333">=</span>&gt; 222,1,Answer<span style="color: #333333">()</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,VoiceMailMain<span style="color: #333333">(</span>@banana-vm<span style="color: #333333">)</span>

<span style="color: #996633">exten</span> <span style="color: #333333">=</span>&gt; _X.,1,Answer<span style="color: #333333">()</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"in PhoneHandset extension"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"dialed number: ${EXTEN}"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Dial<span style="color: #333333">(</span>SIP/<span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">EXTEN</span><span style="color: #008800; font-weight: bold">}</span>@PhoneLine<span style="color: #333333">)</span>

<span style="color: #333333">[</span>PhoneLine<span style="color: #333333">]</span>
<span style="color: #996633">exten</span> <span style="color: #333333">=</span>&gt; 5555555555,1,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"call registered"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Answer<span style="color: #333333">()</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">CallTimestamp</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">STRFTIME</span>(<span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">EPOCH</span><span style="color: #008800; font-weight: bold">}</span>,,%s)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Background<span style="color: #333333">(</span>initial_greet<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,System<span style="color: #333333">(</span>python <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SCRIPTS_DIR</span><span style="color: #008800; font-weight: bold">}</span>add_log.py <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CALLERID</span>(num)<span style="color: #008800; font-weight: bold">}</span> <span style="background-color: #fff0f0">'${CALLERID(name)}'</span> <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CallTimestamp</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">result</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SHELL</span>(python <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SCRIPTS_DIR</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #996633">check_whitelist</span>.py <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CALLERID</span>(num)<span style="color: #008800; font-weight: bold">}</span>)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">inWL</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">REGEX</span>(<span style="background-color: #fff0f0">"([YES])"</span> <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">result</span><span style="color: #008800; font-weight: bold">}</span>)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span>CID in DB: <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">inWL</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,GotoIf<span style="color: #333333">(</span><span style="color: #996633">$[</span><span style="background-color: #fff0f0">"${inWL}"</span> <span style="color: #333333">=</span> <span style="background-color: #fff0f0">"1"</span><span style="color: #333333">]</span>?liveline:banana<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n<span style="color: #333333">(</span>liveline<span style="color: #333333">)</span>,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"passing to live line"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Dial<span style="color: #333333">(</span>SIP/PhoneHandset<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,VoiceMail<span style="color: #333333">(</span>PhoneHandset@banana-vm,u<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,HangUp<span style="color: #333333">()</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n<span style="color: #333333">(</span>banana<span style="color: #333333">)</span>,Goto<span style="color: #333333">(</span>BananaPhone,start,1<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,HangUp<span style="color: #333333">()</span>

<span style="color: #333333">[</span>BananaPhone<span style="color: #333333">]</span>
<span style="color: #996633">exten</span> <span style="color: #333333">=</span>&gt; start,1,Answer<span style="color: #333333">()</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"suspect call in trapline"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">IncomingCID</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CALLERID</span>(num)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">CallTimestamp</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">STRFTIME</span>(<span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">EPOCH</span><span style="color: #008800; font-weight: bold">}</span>,,%s)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">auth</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">RAND</span>(1000,9999)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"generated auth: ${auth}"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Playback<span style="color: #333333">(</span>announcement<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Playback<span style="color: #333333">(</span>at_the_tone<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Playback<span style="color: #333333">(</span>only_once<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">res</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SHELL</span>(python <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SCRIPTS_DIR</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #996633">generate_auth_audio</span>.py <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CallTimestamp</span><span style="color: #008800; font-weight: bold">}</span> <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">auth</span><span style="color: #008800; font-weight: bold">}</span>)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">res</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,System<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">res</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">clip</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SHELL</span>(python <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SCRIPTS_DIR</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #996633">generate_background_audio</span>.py <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CallTimestamp</span><span style="color: #008800; font-weight: bold">}</span>)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">clip</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,System<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">clip</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"This is after the end of the clip"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Read<span style="color: #333333">(</span>auth_input,<span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CallTimestamp</span><span style="color: #008800; font-weight: bold">}</span>,4,s,1,8<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span>grabbed input: <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">auth_input</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,GotoIf<span style="color: #333333">(</span><span style="color: #996633">$[</span><span style="background-color: #fff0f0">"${auth_input}"</span> <span style="color: #333333">=</span> <span style="background-color: #fff0f0">"${auth}"</span><span style="color: #333333">]</span>?success:hangup<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n<span style="color: #333333">(</span>success<span style="color: #333333">)</span>,Playback<span style="color: #333333">(</span>verified<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">ver</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SHELL</span>(python <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SCRIPTS_DIR</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #996633">verify_CID</span>.py <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CALLERID</span>(num)<span style="color: #008800; font-weight: bold">}</span> )<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">ver</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,Set<span style="color: #333333">(</span><span style="color: #996633">addWL</span><span style="color: #333333">=</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">REGEX</span>(<span style="background-color: #fff0f0">"([YES])"</span> <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">ver</span><span style="color: #008800; font-weight: bold">}</span>)<span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,NoOp<span style="color: #333333">(</span><span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">addWL</span><span style="color: #008800; font-weight: bold">}</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,GotoIf<span style="color: #333333">(</span><span style="color: #996633">$[</span><span style="background-color: #fff0f0">"${addWL}"</span> <span style="color: #333333">=</span> <span style="background-color: #fff0f0">"1"</span><span style="color: #333333">]</span>?add:liveline<span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n<span style="color: #333333">(</span>hangup<span style="color: #333333">)</span>,HangUp<span style="color: #333333">()</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n<span style="color: #333333">(</span>add<span style="color: #333333">)</span>,System<span style="color: #333333">(</span>python <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">SCRIPTS_DIR</span><span style="color: #008800; font-weight: bold">}</span>add_whitelist.py <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CALLERID</span>(num)<span style="color: #008800; font-weight: bold">}</span> <span style="color: #008800; font-weight: bold">${</span><span style="color: #996633">CallTimestamp</span><span style="color: #008800; font-weight: bold">}</span> <span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n<span style="color: #333333">(</span>liveline<span style="color: #333333">)</span>,Dial<span style="color: #333333">(</span>SIP/PhoneHandset<span style="color: #333333">)</span>
    ;<span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n<span style="color: #333333">(</span>liveline<span style="color: #333333">)</span>,NoOp<span style="color: #333333">(</span><span style="background-color: #fff0f0">"Success end of authentication"</span><span style="color: #333333">)</span>
    <span style="color: #996633">same</span> <span style="color: #333333">=</span>&gt; n,HangUp<span style="color: #333333">()</span>
</pre></td></tr></tbody></table></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_4_1486061764369_85618"><div class="sqs-block-content">
<p style="margin-left:40px">On line 18, replace "5555555555" with the 10-digit phone number of the phone line plugged into the Obi ATA.</p><p style="margin-left:40px">There a couple subtle dialplan nuances used here, particularly when generating the audio files and when the caller is actually entering in the input from their phone. I will leave that for the reader to dissect if they feel so inclined. Google is your friend, and so is .</p><p style="margin-left:40px">I also peppered in a bunch of NoOp() calls as debug messages you can see in the console.</p><h2>Testing</h2>
</div></div><div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" id="block-yui_3_17_2_4_1486061764369_94233"><div class="sqs-block-content"><hr></div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_4_1486061764369_94584"><div class="sqs-block-content"><p style="margin-left:40px">Testing here is pretty straight forward.</p><ol><li>Call the phone line attached to your Obi ATA</li><li>Follow the instructions</li><li>Input the code</li><li>See if it rings</li><li>If it does, call again, you shouldn't have to test twice</li></ol><h2 style="margin-left:40px">Debugging tips</h2><p style="margin-left:40px">I've tried to write an easy-to-follow tutorial, with little debug checks at the end of every section. However, it's easy to miss steps or forget stuff, so if your install doesn't work right the first time you try, go through these steps:</p><ul><li>Are you able to see calls coming into Asterisk?<ul><li>Try running the minimal dialplan from <a href="https://www.arctangent.io/initial-asterisk-configuration">section 2</a> and see if calls come in. If not, try redoing the configurations on Asterisk and the Obi ATA until you can.</li></ul></li><li>If verified caller IDs keep getting tested, your database probably isn't getting written to.<ul><li>&nbsp; Are the permissions on the banana_phone.db file and it's parent directory <strong>/home/banana/banana_phone</strong> set correctly?</li></ul></li><li>If your Obi ATA isn't registering correctly with Asterisk,<ul><li>Make sure your IP address, usernames and passwords for our SIP endpoints are correct</li><li>Restart Asterisk and check the status page on the Obi</li></ul></li><li>The Asterisk debug console is your friend. Use it to check how calls are being processed, where they mess up in the dialplan, and if your ATA is connected</li><li>When editing extensions.conf, you must reload the dialplan from the Asterisk debug console for changes to take affect. Remember to use this command at the debug console:</li></ul></div></div><div class="sqs-block code-block sqs-block-code" data-block-type="23" id="block-yui_3_17_2_20_1486061764369_59805"><div class="sqs-block-content"><!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%">dialplan reload
</pre></div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_20_1486061764369_61642"><div class="sqs-block-content"><h2>Conclusions</h2></div></div><div class="sqs-block horizontalrule-block sqs-block-horizontalrule" data-block-type="47" id="block-yui_3_17_2_7_1486061764369_41638"><div class="sqs-block-content"><hr></div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_7_1486061764369_43260"><div class="sqs-block-content"><p style="margin-left:40px">That's it for making Banana Phone.&nbsp;</p><p style="margin-left:40px">I'm a one-man army trying to fight phone scams. I'm also in the middle of commercializing my idea, so if this tutorial helped solve your robocall problem or you got some legitimate good information from this, please consider donating to the project. Beer money goes along way ;)</p></div></div></div></div></div>

    </section>

    <div class="sqs-layout sqs-grid-12 columns-12 empty" data-layout-label="Integrate Banana Phone scripts Footer Content" data-type="block-field" id="collection-588fa131c534a5d2ea2e741e"><div class="row sqs-row"><div class="col sqs-col-12 span-12"></div></div></div>

    <!-- <div class="page-divider bottom-divider"></div> -->

    <div class="info-footer-wrapper clear">
      <div class="info-footer">
      <div class="sqs-layout sqs-grid-12 columns-12" data-layout-label="Info Footer Content" data-type="block-field" data-updated-on="1411670375842" id="infoFooterBlock"><div class="row sqs-row"><div class="col sqs-col-12 span-12"></div></div></div>
      
        
        <div id="socialLinks" class="social-links sqs-svg-icon--list" data-content-field="connected-accounts">
          
  <a href="https://www.facebook.com/276074649187125" target="_blank" class="sqs-svg-icon--wrapper facebook">
    <div>
      <svg class="sqs-svg-icon--social" viewBox="0 0 64 64">
        <use class="sqs-use--icon" xlink:href="#facebook-icon"></use>
        <use class="sqs-use--mask" xlink:href="#facebook-mask"></use>
      </svg>
    </div>
  </a>

        </div>
        
      
      </div>
    </div>

    <footer id="footer" class="clear">
      <div class="sqs-layout sqs-grid-12 columns-12" data-layout-label="Footer Content" data-type="block-field" data-updated-on="1486426110661" id="footerBlock"><div class="row sqs-row"><div class="col sqs-col-12 span-12"><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_39_1486061764369_4332"><div class="sqs-block-content"><p class="text-align-center">Follow the project on Facebook</p></div></div><div class="sqs-block socialaccountlinks-v2-block sqs-block-socialaccountlinks-v2" data-block-type="54" id="block-yui_3_17_2_7_1486423094319_8913"><div class="sqs-block-content">

<div class="sqs-svg-icon--outer social-icon-alignment-center social-icons-color-black social-icons-size-medium social-icons-style-regular ">
  <nav class="sqs-svg-icon--list">
    <a href="https://www.facebook.com/276074649187125" target="_blank" class="sqs-svg-icon--wrapper facebook">
      <div>
        <svg class="sqs-svg-icon--social" viewBox="0 0 64 64">
          <use class="sqs-use--icon" xlink:href="#facebook-icon"></use>
          <use class="sqs-use--mask" xlink:href="#facebook-mask"></use>
        </svg>
      </div>
    </a>
  </nav>
</div></div></div></div></div></div>
    </footer>

  </div>

  <div></div>

  <script type="text/javascript" data-sqs-type="imageloader-bootstrapper">(function() {if(window.ImageLoader) { window.ImageLoader.bootstrap({}, document); }})();</script><script>Squarespace.afterBodyLoad(Y);</script><div class="absolute-cart-box" id="yui_3_17_2_1_1546885903013_151"><div id="yui_3_17_2_1_1546885903013_155" class="yui3-widget sqs-widget sqs-pill-shopping-cart sqs-scalable-hidden" style="visibility: hidden; opacity: 0; transform: scale(0.94);"><div id="yui_3_17_2_1_1546885903013_157" class="sqs-pill-shopping-cart-content dark" data-test="continue-to-cart"><div class="icon"></div>

<div class="details">
  <span class="total-quantity">0</span>
  <span class="suffix">items</span>
</div>

<span class="subtotal">
  <span class="price">$0</span>
</span></div></div></div><svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="display:none"><symbol id="facebook-icon" viewBox="0 0 64 64"><path d="M34.1,47V33.3h4.6l0.7-5.3h-5.3v-3.4c0-1.5,0.4-2.6,2.6-2.6l2.8,0v-4.8c-0.5-0.1-2.2-0.2-4.1-0.2 c-4.1,0-6.9,2.5-6.9,7V28H24v5.3h4.6V47H34.1z"></path></symbol><symbol id="facebook-mask" viewBox="0 0 64 64"><path d="M0,0v64h64V0H0z M39.6,22l-2.8,0c-2.2,0-2.6,1.1-2.6,2.6V28h5.3l-0.7,5.3h-4.6V47h-5.5V33.3H24V28h4.6V24 c0-4.6,2.8-7,6.9-7c2,0,3.6,0.1,4.1,0.2V22z"></path></symbol></svg>






</body></html>